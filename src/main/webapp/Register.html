<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>注册</title>
    <link rel="stylesheet" href="css/Register.css">
</head>
<body>
<form id="reg-form" action="/LMB/registerServlet" method="post">
    <div class="login-box">
        <h4>注册</h4>
        <div class="input-box">
            <div class="group" id="user_name">
                <span class="ion"><img src="images/user.png" style="width: 25px;height: 25px;"></span>
                <input type="text" name="username" id="username" placeholder="长度4~12，数字英文大小写字母" class="input">
                <span class="right-ion"><div id="namecheck" class="span-none"></div></span>
            </div>
            <div class="group"  id="userpwd">
                <span class="ion"><img src="images/pwd.png" style="width: 25px;height: 25px;"></span>
                <input type="password" name="password" id="password" placeholder="长度6~20，大小写字母、数字或下划线" class="input">
                <span class="right-ion"><div id="pwdcheck" class="span-none"></div></span>
            </div>
            <div class="group"  id="userrepwd">
                <span class="ion"><img src="images/repwd.png" style="width: 25px;height: 25px;"></span>
                <input type="password" name="repasssword" id="repasssword" placeholder="请再次输入密码进行确认" class="input">
                <span class="right-ion"><div id="repwdcheck" class="span-none"></div></span>
            </div>
            <div class="group"  id="user_email">
                <span class="ion"><img src="images/email.png" style="width: 25px;height: 25px;"></span>
                <input type="text" name="userEmail" id="userEmail" placeholder="用户名@域名（域名后缀至少2个字符)" class="input">
                <span class="right-ion"><div id="emailcheck" class="span-none"></div></span>
            </div>
            <div class="group">
                <p class="p" id="register_sucss"></p>
            </div>
            <input class="button" type="submit" id="register_btn" value="注册">
            <div class="signup">
                已有账户？<a href="Login.html">登录</a>
            </div>
        </div>
    </div>
</form>
</body>
<!--<script>-->
<!--    // 获取所有input框-->
<!--    var inputs = document.getElementsByTagName('input');-->
<!--    // 为每个input框添加失去焦点事件-->
<!--    for (var i = 0; i < inputs.length - 1; ++i) {-->
<!--        inputs[i].onblur = inputBlur;-->
<!--    }-->
<!--    function inputBlur() {-->
<!--        var name = this.name;           // 获取输入框的name值-->
<!--        var val = this.value;           // 获取输入框的value值-->
<!--        var tips = this.placeholder;    // 获取输入框中的提示信息-->
<!--        var tips_obj = this.nextSibling.nextSibling.firstChild;  // 获取提示信息显示的div元素对象-->
<!--        // 1. 去掉两端的空白字符-->
<!--        val = val.trim();-->
<!--        // 2. 文本框内容为空，给出提示信息-->
<!--        if (!val) {-->
<!--            none(tips_obj);-->
<!--            return false;-->
<!--        }-->
<!--        // 3. 获取正则匹配规则和提示信息-->
<!--        var reg_msg = getRegMsg(name, tips);-->
<!--        // 4. 检测是否否he正则匹配-->
<!--        if (reg_msg['reg'].test(val)) {-->
<!--            // 匹配成功，显示成功的提示信息-->
<!--            success(tips_obj, reg_msg['msg']['success']);-->
<!--            return true;-->
<!--        } else {-->
<!--            // 匹配失败，显示失败的提示信息-->
<!--            error(tips_obj, reg_msg['msg']['error']);-->
<!--        }-->
<!--    }-->
<!--    // 根据input的name值，设置正则规则及提示信息-->
<!--    function getRegMsg(name, tips) {-->
<!--        var reg = msg = '';-->
<!--        switch (name) {-->
<!--            case 'username':-->
<!--                reg = /^[a-zA-Z0-9]{4,12}$/;-->
<!--                msg = {'success': '用户名输入正确', 'error': tips};-->
<!--                break;-->
<!--            case 'password':-->
<!--                reg = /^\w{6,20}$/;-->
<!--                msg = {'success': '密码输入正确', 'error': tips};-->
<!--                break;-->
<!--            case 'repasssword':-->
<!--                var con = document.getElementsByTagName('input')[1].value;-->
<!--                reg = RegExp("^" + con + "$");-->
<!--                msg = {'success': '两次密码输入正确', 'error': '两次输入的密码不一致'};-->
<!--                break;-->
<!--            case 'userEmail':-->
<!--                reg = /^(\w+(\_|\-|\.)*)+@(\w+(\-)?)+(\.\w{2,})+$/;-->
<!--                msg = {'success': '邮箱输入正确', 'error': '用户名@域名错误'};-->
<!--                break;-->
<!--        }-->
<!--        return {'reg': reg, 'msg': msg};-->
<!--    }-->
<!--    // 成功-->
<!--    function success(obj, msg) {-->
<!--        obj.className='span-success';-->
<!--        var tips2=obj.parentNode.previousSibling.previousSibling;-->
<!--        tips2.classList.remove('color-error')-->
<!--        tips2.classList.add('color-success');-->
<!--    }-->
<!--    // 失败-->
<!--    function error(obj, msg) {-->
<!--        obj.className='span-error';-->
<!--        document.getElementById("register_sucss").innerHTML = msg;-->
<!--        var top_tips=obj.parentNode.parentNode;-->
<!--        top_tips.classList.add('shake')-->
<!--        setTimeout(()=>{ top_tips.classList.remove('shake') }, 800)-->
<!--        var tips2=obj.parentNode.previousSibling.previousSibling;-->
<!--        tips2.classList.remove('color-success')-->
<!--        tips2.classList.add('color-error');-->
<!--    }-->
<!--    // 没填-->
<!--    function none(obj) {-->
<!--        obj.className='span-none';-->
<!--        document.getElementById("register_sucss").innerHTML ='';-->
<!--        var tips2=obj.parentNode.previousSibling.previousSibling;-->
<!--        tips2.classList.remove('color-error')-->
<!--        tips2.classList.remove('color-success')-->
<!--    }-->
<!--</script>-->
<script>
    //1. 给用户名输入框绑定 失去焦点事件
    document.getElementById("username").onblur = function () {
        //2. 发送ajax请求
        // 获取用户名的值
        var username = this.value; //this ： 给谁绑定的事件，this就代表谁
        // 2.1. 创建核心对象
        var xhttp;
        if (window.XMLHttpRequest) {
            xhttp = new XMLHttpRequest();
        } else {
            // code for IE6, IE5
            xhttp = new ActiveXObject("Microsoft.XMLHTTP");
        }
        //2.2. 发送请求
        xhttp.open("GET", "http://localhost:8080/LMB/selectUserServlet?username="+username);
        xhttp.send();
        //2.3. 获取响应
        xhttp.onreadystatechange = function() {
            if (this.readyState === 4 && this.status === 200) {
                //判断
                if(this.responseText === "true"){
                    //用户名存在，显示提示信息
                    document.getElementById("namecheck").parentNode.previousSibling.previousSibling.classList.remove('color-success');
                    document.getElementById("namecheck").parentNode.previousSibling.previousSibling.classList.add('color-error');
                }else {
                    //用户名不存在 ，清楚提示信息
                    document.getElementById("namecheck").parentNode.previousSibling.previousSibling.classList.remove('color-error');
                    document.getElementById("namecheck").parentNode.previousSibling.previousSibling.classList.add('color-success');

                }
            }
        };
    }
</script>
</html>